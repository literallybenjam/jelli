(function(){"use strict"}).call(this),function(){"use strict";var e,t,i,n=[].slice;t=function(e,t,i,n,r,s,l){var a;return e instanceof Element||(e=null),"object"!=typeof t&&(t=null),a=null!=e?e.getBoundingClientRect():void 0,isNaN(n=Number(n))&&(n=0),isNaN(r=Number(r))&&(r=0),isNaN(s=Number(s))&&(s=null!=e.width?e.width:e.clientWidth),isNaN(l=Number(l))&&(l=null!=e.height?e.height:e.clientHeight),Object.defineProperties(this,{number:{value:i},origin_height:{value:l},origin_width:{value:s},origin_x:{value:n},origin_y:{value:r},target:{value:e}}),Object.defineProperties(this,{start_x:{value:((null!=t?t.pageX:void 0)-a.left-this.origin_x)*this.origin_width/e.clientWidth},start_y:{value:((null!=t?t.pageY:void 0)-a.top-this.origin_y)*this.origin_height/e.clientHeight}}),Object.defineProperties(this,{x:{value:this.start_x,writable:!0},y:{value:this.start_y,writable:!0}})},t.prototype=Object.create(Object.prototype,{updateWith:{value:function(e){var t;if(this.target instanceof Element&&"object"==typeof e)return t=this.target.getBoundingClientRect(),this.x=((null!=e?e.pageX:void 0)-t.left-this.origin_x)*this.origin_width/this.target.clientWidth,this.y=((null!=e?e.pageY:void 0)-t.top-this.origin_y)*this.origin_height/this.target.clientHeight}}}),Object.freeze(t.prototype),i=function(e,t,i,n,r){return e instanceof Element||(e=document.body),isNaN(t=Number(t))&&(t=0),isNaN(i=Number(i))&&(i=0),isNaN(n=Number(n))&&(n=null!=e.width?e.width:e.clientWidth),isNaN(r=Number(r))&&(r=null!=e.height?e.height:e.clientHeight),Object.defineProperties(this,{height:{value:r},target:{value:e},width:{value:n},x:{value:t},y:{value:i}})},i.prototype=Object.create(Object.prototype,{deleteItem:{value:function(e){var t,i,n;n=[];for(t in this)i=this[t],i.number===e&&n.push(delete this[t]);return n}},item:{value:function(e){var t,i;for(t in this)if(i=this[t],i.number===e)return i;return null}},new:{value:function(e,i,n){return this[e]=new t(this.target,i,n,this.x,this.y,this.width,this.height)}}}),Object.freeze(i.prototype),e=function(t,n,r,s,l){var a;null==t&&(t=document.body),this instanceof e&&(t instanceof Element||(t=document.body),isNaN(n=Number(n))&&(n=0),isNaN(r=Number(r))&&(r=0),isNaN(s=Number(s))&&(s=null!=t.width?t.width:t.clientWidth),isNaN(l=Number(l))&&(l=null!=t.height?t.height:t.clientHeight),Object.defineProperties(this,{target:{value:t},clicks:{value:new i(t,n,r,s,l),enumerable:!0},codes:{value:{}},height:{value:l},keys:{value:{}},ownerDocument:{value:(null!=(a=this.target)?a.ownerDocument:void 0)||document},touches:{value:new i(t,n,r,s,l),enumerable:!0},width:{value:s},x:{value:n},y:{value:r}}),window.addEventListener("keydown",this,!1),window.addEventListener("keyup",this,!1),window.addEventListener("contextmenu",this,!1),window.addEventListener("touchstart",this,!1),window.addEventListener("touchend",this,!1),window.addEventListener("touchmove",this,!1),window.addEventListener("touchcancel",this,!1),window.addEventListener("mousedown",this,!1),window.addEventListener("mouseup",this,!1),window.addEventListener("mousemove",this,!1))},e.prototype=Object.create(Object.prototype,{add:{value:function(e){return null!=e&&(this.keys[e]=!1),this}},addCodes:{value:function(){var e,t,i,r,s;if(s=arguments[0],t=2<=arguments.length?n.call(arguments,1):[],null!=s&&null!=this.keys[s])for(i=0,r=t.length;i<r;i++)e=t[i],this.codes[e]=s;return this}},getName:{value:function(e){if(null!=e&&null!=this.codes[e])return this.codes[e]}},handleEvent:{value:function(e){var t,i,n,r,s,l,a,o,u,h,c,f,d,b,g,m,v,p,N,y,O,w,E,T,_,j,x,C,M,I,S,A;if(e instanceof Event)switch(e.type){case"contextmenu":e.preventDefault();break;case"keydown":for(p=[e.code,e.key,e.keyIdentifier,e.keyCode],s=0,a=p.length;s<a;s++)i=p[s],this.isCodeDefined(i)&&this.toggleCode(i,!0);break;case"keyup":for(N=[e.code,e.key,e.keyIdentifier,e.keyCode],l=0,o=N.length;l<o;l++)i=N[l],this.isCodeDefined(i)&&this.toggleCode(i,!1);break;case"mousedown":v=null!=(E=this.target)?E.getBoundingClientRect():void 0,v&&v.left<(T=e.pageX)&&T<v.right&&v.top<(_=e.pageY)&&_<v.bottom&&this.clicks.new(e.button,e,e.button);break;case"mousemove":j=this.clicks;for(n in j)t=j[n],t.updateWith(e);break;case"mouseup":delete this.clicks[e.button];break;case"touchcancel":case"touchend":for(x=e.changedTouches,f=0,u=x.length;f<u;f++)S=x[f],delete this.touches[S.identifier];break;case"touchmove":for(C=e.changedTouches,g=0,h=C.length;g<h;g++)S=C[g],this.touches[S.identifier].updateWith(S);break;case"touchstart":for(v=null!=(M=this.target)?M.getBoundingClientRect():void 0,A=!1,I=e.changedTouches,m=0,c=I.length;m<c;m++)if(b=I[m],v&&v.left<(y=S.pageX)&&y<v.right&&v.top<(O=S.pageY)&&O<v.bottom){for(A=!0,d=null,r=0;d!==r;){d=r,w=this.touches;for(n in w)S=w[n],r===S.number&&r++}this.touches.new(b.identifier,S,d)}A&&e.preventDefault()}}},isActive:{value:function(e){if(null!=e&&null!=this.keys[e])return!!this.keys[e]}},isDefined:{value:function(e){if(null!=e)return null!=this.keys[e]}},isCodeActive:{value:function(e){var t;if(null!=e&&null!=(t=this.codes[e])&&null!=this.keys[t])return!!this.keys[t]}},isCodeDefined:{value:function(e){var t;if(null!=e&&null!=(t=this.codes[e]))return null!=this.keys[t]}},remove:{value:function(e){var t,i,n;for(null!=e&&delete this.keys[e],i=0,n=codes.length;i<n;i++)t=codes[i],null!=e&&this.codes[t]===e&&delete this.codes[t];return this}},removeCodes:{value:function(){var e,t,i,r;for(t=1<=arguments.length?n.call(arguments,0):[],i=0,r=t.length;i<r;i++)e=t[i],delete this.codes[e];return this}},toggle:{value:function(e,t){if(null!=e&&null!=this.keys[e])return this.keys[e]=null!=t&&t||null==t&&!this.keys[e]}},toggleCode:{value:function(e,t){var i;if(null!=e&&(i=this.codes[e])&&null!=this.keys[i])return this.keys[i]=null!=t&&t||null==t&&!this.keys[i]}}}),Object.freeze(e.prototype),e.Poke=Object.freeze(t),e.PokeList=Object.freeze(i),this.Control=Object.freeze(e)}.call(this),function(){"use strict";var e,t,i,n,r,s,l,a=[].slice;"Int8Array"in window&&(t=Object.getPrototypeOf(Int8Array)),i=[0,8,8,16,8,16,32,8,8,32,32],n=[0,8,4,5,2,3,5,1,1,3,3],r=function(e,t,i){return e[Math.floor(i/n[t])]>>t*(i%n[t])&Math.pow(2,t)-1},l=function(e,t,i,r){return e[Math.floor(i/n[t])]=e[Math.floor(i/n[t])]&~(Math.pow(2,t)-1<<t*(i%n[t]))|(r&Math.pow(2,t)-1)<<t*(i%n[t])},s=function(e,t,i){var n,r,s,l,a,o,u,h,c;for(null==e&&(e=[]),n=Object(e),null==n.length&&(n="number"==typeof n.valueOf()||n.valueOf()instanceof Number?[n]:String(n)),u=n.length<0?0:n.length>>>0,r=[],a=0,o=0;o<u;)l="function"==typeof t||t instanceof Function?t.call(null!=i?i:this,n[o]):n[o],1<=(h=l.length)&&h<=2&&("string"==typeof l||l instanceof String)&&(s=l.charCodeAt(0),55296<=s&&s<=56319?2===l.length?(c=l.charCodeAt(1),l=56320<=c&&c<=57343?1024*(s-55296)+c-56320+65536:0):(c="function"==typeof t||t instanceof Function?t.call(null!=i?i:this,n[o+1]):n[o+1],"string"==typeof c||c instanceof String?c=1===c.length?c.charCodeAt(0):0:isNaN(c=Number(c))&&(c=0),56320<=c&&c<=57343?(l=1024*(s-55296)+c-56320+65536,o++):l=s):l=1===l.length?s:0),isNaN(l=Number(l))&&(l=0),r[a++]=l,o++;return r},e=function(a,o,u,h){var c,f,d,b,g,m,v,p,N;if((N=this)instanceof e||(N=Object.create(e.prototype)),N.unitSize=a<0?0:a>>>0,N.unitSize>32&&(N.unitSize=32),"undefined"!=typeof ArrayBuffer&&null!==ArrayBuffer&&o instanceof ArrayBuffer?(N.buffer=o,(N.byteOffset=u)<0&&(N.byteOffset=0),(N.byteOffset>>>=0)>N.buffer.byteLength&&(N.byteOffset=N.buffer.byteLength),N.length=h<0?0:h>>>0,b=N.unitSize<11?n[N.unitSize]:1,m=N.unitSize<11?i[N.unitSize]:N.unitSize<17?16:32,g=Math.ceil(N.length/b)*m/8,g>N.buffer.byteLength-N.byteOffset&&(g=N.buffer.byteLength-N.byteOffset),d=new(function(){if(null==t)return Array;switch(m){case 0:return function(){};case 8:return Uint8Array;case 16:return Uint16Array;default:return Uint32Array}}())(N.buffer,N.byteOffset,g),d.length*b<N.length&&(N.length=d.length*b),N.byteLength=d.byteLength,c=[]):(null!=o&&(o instanceof Array||isNaN(o))?(c=s(o),N.length=c.length):(c=[],N.length=o<0?0:o>>>0),b=N.unitSize<11?n[N.unitSize]:1,m=N.unitSize<11?i[N.unitSize]:N.unitSize<17?16:32,d=new(function(){if(null==t)return Array;switch(m){case 0:return function(){};case 8:return Uint8Array;case 16:return Uint16Array;default:return Uint32Array}}())(n?Math.ceil(N.length/b):0),N.buffer=d.buffer,N.byteOffset=0,N.byteLength=d.byteLength),N.length)for(f=v=0,p=N.length-1;0<=p?v<=p:v>=p;f=0<=p?++v:--v)Object.defineProperty(N,f,{get:r.bind(N,d,N.unitSize,f),set:l.bind(N,d,N.unitSize,f),enumerable:!0}),null!=c[f]&&(N[f]=c[f]);return N.constructor=e,Object.defineProperties(N,{buffer:{enumerable:!1},constructor:{enumerable:!1},byteLength:{enumerable:!1},byteOffset:{enumerable:!1},length:{enumerable:!1},unitSize:{enumerable:!1}}),Object.freeze(N)},e.prototype=Object.create(Array.prototype,{set:function(t,i){var n;if(this instanceof e)for(t=s(t),i=i<0?0:i>>>0,n=0;n<t.length&&n+i<this.length;)this[n+i]=t[n],n++},subarray:function(){throw new TypeError("subarray not supported for Data objects")}}),Object.freeze(e.prototype),e.from=function(t,i,n,r){return e.call(this,t,s(i,n,r))},e.of=function(){var t,i;return t=arguments[0],i=2<=arguments.length?a.call(arguments,1):[],e.call(this,t,i)},Object.defineProperties(e,{name:{value:"Data"},length:{value:3},BYTES_PER_ELEMENT:{value:NaN}}),this.Data=Object.freeze(e)}.call(this),function(){"use strict";var e,t={}.hasOwnProperty;e=function(e){var i,r,s,l,a,o;for("string"==typeof e||e instanceof String||(e=""),a=[],o=e.split("\n%%\n"),i=function(e){var i,r,s,l,o,u,h,c,f,d,b;for(c={},o=void 0,f=void 0,d=e.split("\n"),i=function(e){var t,i;if("%"!==e[0]){if(i=e.indexOf(" : "),i!==-1){for(t=0;""===e[n];)t++;null==f&&(f=t)}i===-1||t!==f?null!=o&&(Array.isArray(c[o])?c[o][c[o].length-1]+="\n"+e.trim():c[o]+="\n"+e.trim()):(o=e.substr(0,i).trim(),null!=c[o]?Array.isArray(c[o])?c[o][c[o].length]=e.substr(i+3).trim():c[o]=[c[o],e.substr(i+3)]:c[o]=e.substr(i+3))}},s=0,u=d.length;s<u;s++)h=d[s],i(h);r=!0;for(l in c)if(t.call(c,l)){b=c[l],r=!1;break}r||(a[a.length]=c)},r=0,s=o.length;r<s;r++)l=o[r],i(l);return Object.defineProperties(this,{source:{value:String(e)},records:{value:Object.freeze(a)}})},Screen.prototype=Object.freeze(Object.create(Object.prototype)),this.Gel=Object.freeze(e)}.call(this),function(){"use strict";var e,t,i,n,r,s=[].slice;r=function(e,t,i,r,s){var l,a,o,u;if(e instanceof n&&t<e.size&&i instanceof CanvasRenderingContext2D)return isNaN(t=Number(t))&&(t=0),isNaN(r=Math.round(r))&&(r=0),isNaN(s=Math.round(s))&&(s=0),a=t%e.width,o=Math.floor(t/e.width),e.canvas instanceof HTMLCanvasElement&&!isNaN(a)&&!isNaN(o)&&(u=Number(e.letter_width))&&(l=Number(e.letter_height))?i.drawImage(e.canvas,a*u,o*l,u,l,r,s,u,l):void 0},e=function(e,t){return e instanceof n||(e=null),isNaN(t=Number(t))&&(t=0),Object.defineProperties(this,{canvas:{value:e?e.canvas:null},draw:{value:r.bind(this,e,t)},height:{value:e?e.letter_height:0},index:{value:t},letters:{value:e},width:{value:e?e.letter_width:0}})},e.prototype=Object.create(Object.prototype,{draw:{value:function(){}}}),Object.freeze(e.prototype),i=function(e,t){var i,r,s,l,a,o,u;for(e instanceof n||(e=null),t=String(t),i=0,r=0,s=0,Object.defineProperties(this,{delIndex:{get:function(){return i},set:function(e){if(!isNaN(e=Math.round(e)))return i=e}},drawIndex:{get:function(){return r},set:function(e){if(!isNaN(e=Math.round(e)))return r=e}},index:{get:function(){return s},set:function(e){if(!isNaN(e=Math.round(e)))return s=e}}}),Object.defineProperties(this,{data:{value:t},length:{value:t.length},letters:{value:e}}),u=l=0,a=t.length;l<a;u=++l)o=t[u],Object.defineProperty(this,u,{value:null!=e?e.item(t.charCodeAt(u)):void 0,enumerable:!0});return this},i.prototype=Object.create(Object.prototype,{advance:{value:function(e){var t;return null==e&&(e=1),t=this.index,t+=isNaN(e=Math.round(e))?1:e,t<0&&(t=0),t>this.length&&(t=this.length),this.index=t,this.delIndex>t&&(this.delIndex=t),t}},clear:{value:function(){return this.index=this.delIndex=0}},draw:{value:function(t,i,r){var s,l;if(t instanceof CanvasRenderingContext2D&&this.letters instanceof n&&(l=Number(this.letters.letter_width))&&(s=Number(this.letters.letter_height))){for(isNaN(i=Math.round(i))&&(i=0),isNaN(r=Math.round(r))&&(r=0),this.drawIndex>this.length&&(this.drawIndex=this.length),this.drawIndex<0&&(this.drawIndex=0),this.delIndex>this.index&&(this.delIndex=this.index),this.delIndex<0&&(this.delIndex=0),this.drawIndex>this.delIndex&&(t.clearRect(i+this.delIndex*(l+this.letters.letter_spacing),r,(this.drawIndex-this.delIndex)*(l+this.letters.letter_spacing),s+this.letters.letter_spacing),this.drawIndex=this.delIndex);this.drawIndex<this.length&&this.drawIndex<this.index;)this[this.drawIndex]instanceof e&&this[this.drawIndex].draw(t,i+this.drawIndex*(l+this.letters.letter_spacing),r),this.drawIndex++;return this.delIndex=this.drawIndex}}},fill:{value:function(){return this.index=this.length}},item:{value:function(t){return this[t]instanceof e?this[t]:null}}}),Object.freeze(i.prototype),t=function(){var e,t,r,l,a,o,u,h,c,f,d;for(l=arguments[0],e=arguments[1],f=arguments[2],d=arguments[3],c=5<=arguments.length?s.call(arguments,4):[],e instanceof CanvasRenderingContext2D||(e=null),l instanceof n||(l=null),isNaN(f=Math.round(f))&&(f=0),isNaN(d=Math.round(d))&&(d=0),u=t=0,r=c.length;t<r;u=++t)h=c[u],Object.defineProperty(this,u,{value:h instanceof i?h:new i(l,h),enumerable:!0});return Object.defineProperties(this,{context:{value:e},height:{value:c.length},letters:{value:l}}),a=function(e){var t,i;for(t=0,i=0;t<this.height&&this[t][e]===this[t].length;)i+=this[t].length,t++;return t<this.height?i+this[t][e]:i},o=function(e,t){var i,n;for(i=0,isNaN(t=Number(t))&&(t=0);i<this.height&&t>this[i].length;)t-=this[i][e]=this[i].length,i++;for(i<this.height&&(this[i][e]=t),n=[];++i<this.height;)n.push(this[i][e]=0);return n},Object.defineProperties(this,{delIndex:{get:a.bind(this,"delIndex"),set:o.bind(this,"delIndex")},drawIndex:{get:a.bind(this,"drawIndex"),set:o.bind(this,"drawIndex")},index:{get:a.bind(this,"index"),set:o.bind(this,"index")}}),Object.defineProperty(this,"length",{get:function(){var e,t;for(e=0,t=0;e<this.height;)t+=this[e++].length;return t}}),Object.defineProperties(this,{x:{get:function(){return f},set:function(e){if(!isNaN(e))return f=Number(e),this.delIndex=0,this.drawIndex=0}},y:{get:function(){return d},set:function(e){if(!isNaN(e))return d=Number(e),this.delIndex=0,this.drawIndex=0}}})},t.prototype=Object.create(i.prototype,{draw:{value:function(){var e,t,n;t=this.y;for(e in this)n=this[e],n instanceof i&&n.draw(this.context,this.x,t),t+=this.letters.letter_height+this.letters.letter_spacing}},item:{value:function(e){var t;if(t=0,isNaN(e=Number(e)))return null;for(;null!=this[t]&&e>this[t].length;)e-=this[t++].length;return null!=this[t]?this[t].item(e):null}},line:{value:function(e){return this[e]instanceof i?this[e]:null}}}),Object.freeze(t.prototype),n=function(t,i,r,s,l){var a,o,u,h,c,f,d,b;for(null==l&&(l=document),t instanceof HTMLImageElement||t instanceof SVGImageElement||t instanceof HTMLCanvasElement||"undefined"!=typeof createImageBitmap&&null!==createImageBitmap&&t instanceof ImageBitmap||(t=void 0),isNaN(i=Number(i))&&(i=0),isNaN(r=Number(r))&&(r=0),isNaN(s=Number(s))&&(s=1),l instanceof Document||(l=document),t instanceof Element&&t.ownerDocument!==l&&(t=l.importNode(t,!0)),(null==t||isNaN(b=Number(t.naturalWidth?t.naturalWidth:t.width)))&&(b=0),(null==t||isNaN(d=Number(t.naturalHeight?t.naturalHeight:t.height)))&&(d=0),null!=t?(a=l.createElement("canvas"),a.width=Math.floor(b/i)*i,a.height=Math.floor(d/r)*r,u=a.getContext("2d"),t instanceof HTMLImageElement&&!t.complete||u.drawImage(t,0,0)):a=u=null,Object.defineProperties(this,{canvas:{value:a},context:{value:u},height:{value:Math.floor(d/r)},letter_height:{value:r},letter_width:{value:i},letter_spacing:{value:s},size:{value:Math.floor(d/r)*Math.floor(b/i)},source:{value:t},width:{value:Math.floor(b/i)}}),o=n.NO_COLOR,Object.defineProperty(this,"color",{get:function(){return o},set:function(e){if(e===n.NO_COLOR){if(o=e,this.context instanceof CanvasRenderingContext2D&&(this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),!(this.source instanceof HTMLImageElement)||this.source.complete))return this.context.drawImage(this.source,0,0)}else if(o=String(e),this.context instanceof CanvasRenderingContext2D)return this.context.globalCompositeOperation="source-in",this.context.fillStyle=o,this.context.fillRect(0,0,this.context.canvas.width,this.context.canvas.height),this.context.globalCompositeOperation="source-over"}}),c=this.size,f=[],h=function(t){return null!=f[t]?f[t]:f[t]=new e(this,t)};c-- >0;)Object.defineProperty(this,c,{get:h.bind(this,c)});return this},n.prototype=Object.create(Object.prototype,{clearColor:{value:function(){return this.color=n.NO_COLOR}},createBlock:{value:function(){var e,i,n,r;return e=arguments[0],n=arguments[1],r=arguments[2],i=4<=arguments.length?s.call(arguments,3):[],new(t.bind.apply(t,[null,this,e,n,r].concat(s.call(i))))}},createString:{value:function(e){return new i(this,e)}},item:{value:function(t){return this[t]instanceof e?this[t]:null}}}),Object.freeze(n.prototype),Object.defineProperty(n,"NO_COLOR",{value:"undefined"!=typeof Symbol&&null!==Symbol?Symbol("none"):Object.freeze(Object.create(null))}),n.Block=Object.freeze(t),n.Letter=Object.freeze(e),n.String=Object.freeze(i),this.Letters=Object.freeze(n)}.call(this),function(){"use strict";var e;e=function(e,t){var i;return null==t&&(t="2d"),e instanceof HTMLCanvasElement?i=e.ownerDocument:(i=document,e=i.getElementById(e),e instanceof HTMLCanvasElement||(e=void 0)),Object.defineProperties(this,{canvas:{value:e,enumerable:!0},context:{value:e?e.getContext(t):void 0,enumerable:!0},height:{get:function(){if(this.canvas)return this.canvas.height},set:function(e){if(this.canvas)return this.canvas.height=e}},ownerDocument:{value:i},width:{get:function(){if(this.canvas)return this.canvas.width},set:function(e){if(this.canvas)return this.canvas.width=e}}})},e.prototype=Object.create(Object.prototype,{clear:{value:function(){if(this.canvas instanceof HTMLCanvasElement)switch(!1){case!(this.context instanceof CanvasRenderingContext2D):this.context.clearRect(0,0,this.canvas.width,this.canvas.height);break;case!(this.context instanceof WebGLRenderingContext):this.context.clear(this.context.COLOR_BUFFER_BIT|context.DEPTH_BUFFER_BIT);break;default:this.canvas.width=this.canvas.width}}}}),Object.freeze(e.prototype),this.Screen=Object.freeze(e)}.call(this),function(){"use strict";var e,t,i;i=function(t,i,n,r,s,l){var a,o,u,h,c,f;if(null==l&&(l=0),t instanceof e&&i<t.size&&n instanceof CanvasRenderingContext2D)return isNaN(i=Number(i))&&(i=0),isNaN(r=Math.round(r))&&(r=0),isNaN(s=Math.round(s))&&(s=0),isNaN(l=Number(l))&&(l=0),i+=l,o=i%t.width,h=Math.floor(i/t.width),c=t.source,u=t.image,(c instanceof HTMLImageElement&&c.complete||c instanceof SVGImageElement||c instanceof HTMLCanvasElement||"undefined"!=typeof createImageBitmap&&null!==createImageBitmap&&(u instanceof ImageBitmap||c instanceof ImageBitmap))&&!isNaN(o)&&!isNaN(h)&&(f=Number(t.sprite_width))&&(a=Number(t.sprite_height))?n.drawImage("undefined"!=typeof createImageBitmap&&null!==createImageBitmap&&u instanceof ImageBitmap?u:c,o*f,h*a,f,a,r,s,f,a):void 0},t=function(t,n,r){return null==r&&(r=1),t instanceof e||(t=null),isNaN(n=Number(n))&&(n=0),(isNaN(r=Number(r))||r<=0)&&(r=1),Object.defineProperty(this,"draw",{value:i.bind(this,t,n)}),this.height=t?t.sprite_height:0,this.index=n,this.frames=r,this.sheet=t,this.width=t?t.sprite_width:0,Object.freeze(this)},t.prototype={draw:function(){}},Object.freeze(t.prototype),e=function(e,t,i){var n,r,s;return e instanceof HTMLImageElement||e instanceof SVGImageElement||e instanceof HTMLCanvasElement||"undefined"!=typeof createImageBitmap&&null!==createImageBitmap&&e instanceof ImageBitmap||(e=null),isNaN(t=Number(t))&&(t=0),isNaN(i=Number(i))&&(i=0),(null==e||isNaN(s=Number(null!=e.naturalWidth?e.naturalWidth:e.width)))&&(s=0),(null==e||isNaN(r=Number(null!=e.naturalHeight?e.naturalHeight:e.height)))&&(r=0),this.height=Math.floor(r/i),this.source=e,this.sprite_height=i,this.sprite_width=t,this.width=Math.floor(s/t),this.size=this.width*this.height,n=null,Object.defineProperty(this,"image",{get:function(){return n}}),"undefined"!=typeof createImageBitmap&&null!==createImageBitmap&&createImageBitmap(e).then(function(e){return n=e}),Object.freeze(this)},e.prototype={drawIndex:function(e,t,n,r){return i(this,t,e,n,r)},getSprite:function(e,i){return null==i&&(i=1),new t(this,e,i)}},Object.freeze(e.prototype),e.draw=function(e,i,n,r,s){if(null==s&&(s=0),i instanceof t)return i.draw(e,n,r,s)},e.drawSheetAtIndex=function(t,i,n,r,s){if(i instanceof e)return i.drawIndex(t,n,r,s)},e.Sprite=Object.freeze(t),this.Sheet=Object.freeze(e)}.call(this),function(){"use strict";var e,t,i,n;n=function(e){var t,i,n,r,s,l,a,o;for(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/-_",o={},n=r=0,s=t.length;r<s;n=++r)l=t[n],o[l]=n;if(!((e=String(e)).length%4)){for(a=("="===e[e.length-2])+("="===e[e.length-1]),i="undefined"!=typeof Uint8Array&&null!==Uint8Array?new Uint8Array(3*e.length/4-a):new Array(3*e.length/4-a),n=0;n<e.length/4;)l=o[e[4*n]]<<18|o[e[4*n+1]]<<12|o[e[4*n+2]]<<6|o[e[4*n+3]],i[3*n]=l>>16&255,i[3*n+1]=l>>8&255,i[3*n+2]=255&l,n++;return i}},e=function(i,r,s,l,a,o,u,h){var c;return i instanceof t||(i=null),r instanceof CanvasRenderingContext2D||(r=null),s=n(s),isNaN(l=Math.ceil(l))&&(l=0),c=Math.ceil(s.length/l),isNaN(u=Math.round(u))&&(u=0),isNaN(h=Math.round(h))&&(h=0),a===e.CENTER&&null!=r&&null!=i&&(a=Math.floor((r.canvas.width-i.tile_width*l)/2)-u),isNaN(a=Math.round(a))&&(a=0),o===e.CENTER&&null!=r&&null!=i&&(o=Math.floor((r.canvas.height-i.tile_height*c)/2)-h),isNaN(o=Math.round(o))&&(o=0),this.context=r,this.map=s,i&&(this.tile_height=i.tile_height),i&&(this.tile_width=i.tile_width),this.tiles_tall=c,this.tiles_wide=l,this.tileset=i,Object.defineProperties(this,{origin_x:{get:function(){return u},set:function(e){if(!isNaN(e=Math.round(e)))return u=e}},origin_y:{get:function(){return h},set:function(e){if(!isNaN(e=Math.round(e)))return h=e}},x:{get:function(){return a},set:function(e){if(!isNaN(e=Math.round(e)))return a=e}},y:{get:function(){return o},set:function(e){if(!isNaN(e=Math.round(e)))return o=e}}}),Object.freeze(this)},e.prototype=Object.create(Object.prototype,{collides:{value:function(e,i){var n,r,s;return this.tileset instanceof t&&!isNaN(e=Number(e))&&!isNaN(i=Number(i))?(r=isNaN(this.x)?e:e-this.x,s=isNaN(this.y)?i:i-this.y,r<0||r>=this.tile_width*this.tiles_wide||s<0||s>=this.tile_height*this.tiles_tall?0:(n=this.tileset.getCollision(this.map[Math.floor(r/this.tile_width)+Math.floor(s/this.tile_height)*this.tiles_wide]),n&1*(1+(r%this.tile_width>=this.tile_width/2))*(1+3*(s%this.tile_height>=this.tile_height/2)))):0}},draw:{value:function(){var e,i,n;if(this.context instanceof CanvasRenderingContext2D&&this.tileset instanceof t&&!(isNaN(this.x)||isNaN(this.y)||isNaN(this.origin_x)||isNaN(this.origin_y))&&Number(this.tile_width)&&Number(this.tile_height)&&Number(this.tiles_wide)&&"object"==typeof this.map)for(e=i=0,n=this.map.length;0<=n?i<=n:i>=n;e=0<=n?++i:--i)this.tileset.draw(this.context,this.map[e],Number(this.x)-Number(this.origin_x)+e%this.tiles_wide*this.tile_width,Number(this.y)-Number(this.origin_y)+Math.floor(e/this.tiles_wide)*this.tile_height)}},getCollisionEdge:{value:function(i,n,r){var s,l,a,o,u,h,c,f;if(!(i!==e.BOTTOM_EDGE&&i!==e.LEFT_EDGE&&i!==e.RIGHT_EDGE&&i!==e.TOP_EDGE||isNaN(n=Number(n))||isNaN(r=Number(r)))){if(s=t.collisions,c=Math.round(isNaN(this.x)?n:n-this.x),f=Math.round(isNaN(this.y)?r:r-this.y),u=Math.floor(c/this.tile_width),h=Math.floor(f/this.tile_height),o=u+h*this.tiles_wide,c%(this.tile_width/2)===0||f%(this.tile_height/2)===0||c<0||c>=this.tile_width*this.tiles_wide||f<0||f>=this.tile_height*this.tiles_tall?a=l=s.NO_COLLISION:(l=this.tileset.getCollision(this.map[o]),a=this.collides(n,r)),!a)return i===e.LEFT_EDGE||i===e.RIGHT_EDGE?n:r;switch(i){case e.BOTTOM_EDGE:return a===s.TOPLEFT&&l&s.BOTTOMLEFT||a===s.TOPRIGHT&&l&s.BOTTOMRIGHT||a===s.BOTTOMLEFT||a===s.BOTTOMRIGHT?h*this.tile_height+this.tile_height+this.y:h*this.tile_height+this.tile_height/2+this.y;case e.LEFT_EDGE:return a===s.TOPRIGHT&&l&s.TOPLEFT||a===s.BOTTOMRIGHT&&l&s.BOTTOMLEFT||a===s.TOPLEFT||a===s.BOTTOMLEFT?u*this.tile_width+this.x:u*this.tile_width+this.tile_width/2+this.x;case e.RIGHT_EDGE:return a===s.TOPLEFT&&l&s.TOPRIGHT||a===s.BOTTOMLEFT&&l&s.BOTTOMRIGHT||a===s.TOPRIGHT||a===s.BOTTOMRIGHT?u*this.tile_width+this.tile_width+this.x:u*this.tile_width+this.tile_width/2+this.x;case e.TOP_EDGE:return a===s.BOTTOMLEFT&&l&s.TOPLEFT||a===s.BOTTOMRIGHT&&l&s.TOPRIGHT||a===s.TOPLEFT||a===s.TOPRIGHT?h*this.tile_height+this.y:h*this.tile_height+this.tile_height/2+this.y}}}}}),Object.freeze(e.prototype),Object.defineProperties(e,{BOTTOM_EDGE:{value:"undefined"!=typeof Symbol&&null!==Symbol?Symbol("bottom"):Object.freeze(Object.create(null))},CENTER:{value:"undefined"!=typeof Symbol&&null!==Symbol?Symbol("center"):Object.freeze(Object.create(null))},LEFT_EDGE:{value:"undefined"!=typeof Symbol&&null!==Symbol?Symbol("left"):Object.freeze(Object.create(null))},RIGHT_EDGE:{value:"undefined"!=typeof Symbol&&null!==Symbol?Symbol("right"):Object.freeze(Object.create(null))},TOP_EDGE:{value:"undefined"!=typeof Symbol&&null!==Symbol?Symbol("top"):Object.freeze(Object.create(null))}}),t=function(e,t,i,r,s){return isNaN(t=Number(t))&&(t=0),isNaN(i=Number(i))&&(i=0),"function"==typeof s||s instanceof Function||(s=null),this.collisions=n(r),this.drawFunction=s,this.sheet=e,this.tile_height=i,this.tile_width=t,Object.freeze(this)},t.prototype=Object.create(Object.prototype,{draw:{value:function(e,t,i,n){if("function"==typeof this.drawFunction||this.drawFunction instanceof Function)return this.drawFunction(e,this.sheet,t,i,n)}},getMap:{value:function(t,i,n,r,s,l,a){return new e(this,t,i,n,r,s,l,a)}},getCollision:{value:function(e){return isNaN(e)?0:this.collisions[Math.floor(e/2)]>>4*((e+1)%2)&15}}}),Object.freeze(t.prototype),i=Object.create(Object.prototype,{EMPTY:{value:0,enumerable:!0},NO_COLLISION:{value:0},SECTOR_00:{value:1,enumerable:!0},SECTOR_01:{value:2,enumerable:!0},SECTOR_02:{value:4,enumerable:!0},SECTOR_03:{value:8,enumerable:!0},SECTOR_04:{value:16,enumerable:!0},SECTOR_05:{value:32,enumerable:!0},SECTOR_06:{value:64,enumerable:!0},SECTOR_07:{value:128,enumerable:!0},SECTOR_08:{value:256,enumerable:!0},SECTOR_09:{value:512,enumerable:!0},SECTOR_10:{value:1024,enumerable:!0},SECTOR_11:{value:2048,enumerable:!0},SECTOR_12:{value:4096,enumerable:!0},SECTOR_13:{value:8192,enumerable:!0},SECTOR_14:{value:16384,enumerable:!0},SECTOR_15:{value:32768,enumerable:!0},SECTOR_16:{value:65536,enumerable:!0},SECTOR_17:{value:131072,enumerable:!0},SECTOR_18:{value:262144,enumerable:!0},SECTOR_19:{value:524288,enumerable:!0},SECTOR_20:{value:1048576,enumerable:!0},SECTOR_21:{value:2097152,enumerable:!0},SECTOR_22:{value:4194304,enumerable:!0},SECTOR_23:{value:8388608,enumerable:!0},SECTOR_24:{value:16777216,enumerable:!0},SECTOR_25:{value:33554432,enumerable:!0},SECTOR_26:{value:67108864,enumerable:!0},SECTOR_27:{value:134217728,enumerable:!0},SECTOR_28:{value:268435456,enumerable:!0},SECTOR_29:{value:536870912,enumerable:!0},SECTOR_30:{value:1073741824,enumerable:!0},SECTOR_31:{value:2147483648,enumerable:!0},TOPLEFT:{value:1},TOPRIGHT:{value:2},BOTTOMLEFT:{value:4},BOTTOMRIGHT:{value:8}}),Object.defineProperty(t,"collisions",{value:Object.freeze(i)}),t.Map=Object.freeze(e),this.Tileset=Object.freeze(t)}.call(this),function(){"use strict"}.call(this),function(){"use strict";var e;e=function(){return Object.defineProperty(this,"functions",{value:null,writable:!0})},e.prototype=Object.create(Object.prototype,{run:{value:function(e){if(null!=this.functions&&("function"==typeof this.functions[e]||this.functions[e]instanceof Function))return this.functions[e].call(this)}}}),Object.freeze(e.prototype),this.Jelli=Object.freeze(e)}.call(this),function(){"use strict";var e;e=function(e){var t,i,n,r,s,l,a,o,u,h,c,f,d,b,g,m,v,p,N,y,O,w,E,T;if(null==e&&(e=document),Jelli.call(this),e instanceof Document&&null==e.game){for(Object.defineProperty(e,"game",{value:this}),i=e.createElement("div"),g=e.getElementsByClassName("DATA"),r=0,a=g.length;r<a;r++)n=g[r],i.appendChild(n);for(Object.defineProperties(this,{characters:{value:new Collection(this,Character)},data:{value:i},document:{value:e},functions:{value:document.body.functions},images:{value:new Collection(this,PlacementImage)},letters:{value:{}},screens:{value:{}},sheets:{value:{}},texts:{value:new Collection(this,Text)},tilesets:{value:{}},views:{value:{}},window:{value:e.defaultView||window}}),t=null,w=!0,Object.defineProperties(this,{area:{get:function(){return t},set:function(e){return e instanceof Area?t=e:this.loadArea(e)}},resized:{get:function(){return w},set:function(e){return w=!!e}}}),m=e.getElementsByClassName("VIEW"),s=0,o=m.length;s<o;s++){T=m[s],this.views[T.id]=new View(this,T),v=this.views[T.id].screens;for(d in v)E=v[d],this.screens[d]=E}for(Object.freeze(this.views),Object.freeze(this.screens),p=i.getElementsByClassName("LETTERS"),l=0,u=p.length;l<u;l++)n=p[l],this.letters[n.id]=new Letters(n,n.getAttribute("data-sprite-width"),n.getAttribute("data-sprite-height"),n.getAttribute("data-letter-spacing"),e);for(Object.freeze(this.letters),N=i.getElementsByClassName("SHEET"),f=0,h=N.length;f<h;f++)n=N[f],this.sheets[n.id]=new Sheet(n,n.getAttribute("data-sprite-width"),n.getAttribute("data-sprite-height"));for(Object.freeze(this.sheets),y=i.getElementsByClassName("TILESET"),b=0,c=y.length;b<c;b++)n=y[b],this.tilesets[n.id]=new Tileset(new Sheet(n,n.getAttribute("data-sprite-width"),n.getAttribute("data-sprite-height")),n.getAttribute("data-sprite-width"),n.getAttribute("data-sprite-height"),null!=(O=n.getAttribute("data-collisions"))?O.trim():void 0,Sheet.drawSheetAtIndex);return Object.freeze(this.tilesets),this.run("init"),Object.seal(this),this.window.addEventListener("resize",this,!1),this.window.requestAnimationFrame(this.draw.bind(this)),this.step()}},e.prototype=Object.create(Jelli.prototype,{clearScreen:{value:function(e){return this.screens[e].canvas.setAttribute("data-clear","")}},draw:{value:function(){var e,t,i,n,r,s,l,a,o;if(this.resized){t=this.views;for(e in t)o=t[e],o.layout()}i=this.screens;for(e in i)if(l=i[e],l.canvas.hasAttribute("data-clear"))l.clear(),l.canvas.removeAttribute("data-clear");else switch(l.canvas.getAttribute("data-type")){case"area":this.area instanceof Area&&this.area.clear&&l.clear();break;case"animation":l.clear()}this.area instanceof Area&&this.area.draw(),null!=(n=this.characters)&&n.doForEach(function(e){return e.draw()}),null!=(r=this.images)&&r.doForEach(function(e){return e.draw()}),s=this.texts;for(e in s)a=s[e],a.draw();return this.resized=!1,this.window.requestAnimationFrame(this.draw.bind(this))}},getDataElement:{value:function(e,t){var i,n,r;return n=e?this.data.getElementsByClassName(e):this.data.getElementsByTagName("*"),("number"==typeof t||t instanceof Number)&&(i=n.item(t)),null!=i?i:(r=e?"#"+t+"."+e:"#"+t,n instanceof HTMLCollection&&("function"==typeof n.namedItem||n.namedItem instanceof Function)?n.namedItem(t):this.data.querySelector(r))}},getDocElement:{value:function(e,t){var i,n,r;return n=e?document.getElementsByClassName(e):document.getElementsByTagName("*"),("number"==typeof t||t instanceof Number)&&(i=n.item(t)),null!=i?i:(r=e?"#"+t+"."+e:"#"+t,n instanceof HTMLCollection&&("function"==typeof n.namedItem||n.namedItem instanceof Function)?n.namedItem(t):document.querySelector(r))}},handleEvent:{value:function(e){switch(e.type){case"resize":return this.resized=!0}}},loadArea:{value:function(e){return this.area=new Area(this,e)}},step:{value:function(){var e;return this.run("step"),null!=(e=this.characters)&&e.doForEach(function(e){return e.step();
}),this.area instanceof Area&&this.area.step(),this.run("then"),this.window.setTimeout(this.step.bind(this),1e3/60)}}}),Object.freeze(e.prototype),e.defineFunctions=function(e,t){return e instanceof Element||(e=document.getElementById(e)),e.functions=Object.freeze(t)},e.getSymbol=function(e){return"undefined"!=typeof Symbol&&null!==Symbol?Symbol(e):Object.freeze(Object.create(null,{toString:{value:String.bind(null,e)}}))},this.Game=Object.freeze(e)}.call(this),function(){"use strict";var e;e=function(e,t){var i,n,r,s,l,a,o,u,h,c,f,d,b,g,m,v,p,N,y;for(Jelli.call(this),e instanceof Game||(e=null),n=(null!=e?e.getDataElement("AREA",t):void 0)||null,Object.defineProperty(this,"game",{value:e}),Object.defineProperties(this,{characters:{value:new Collection(this,Character)},functions:{value:null!=n?n.functions:void 0},images:{value:new Collection(this,PlacementImage)},maps:{value:[]}}),Object.defineProperty(this,"id",{get:function(){return t},set:function(e){return this.game.area=e}}),i=!0,Object.defineProperty(this,"clear",{get:function(){return i},set:function(e){return i=!!e}}),N=0,y=0,Object.defineProperties(this,{x:{get:function(){return N},set:function(e){var t,i,n,r;if(!isNaN(N=Number(e))){for(r=this.maps,t=0,i=r.length;t<i;t++)n=r[t],n.origin_x=N;return this.clear=!0}}},y:{get:function(){return y},set:function(e){var t,i,n,r;if(!isNaN(y=Number(e))){for(r=this.maps,t=0,i=r.length;t<i;t++)n=r[t],n.origin_y=y;return this.clear=!0}}}}),f=(null!=n?n.getElementsByClassName("MAP"):void 0)||[],r=s=0,o=f.length;s<o;r=++s)c=f[r],this.maps[r]=null!=e&&null!=(d=e.tilesets[c.getAttribute("data-tileset")])?d.getMap(null!=e&&null!=(b=e.screens[c.getAttribute("data-screen")])?b.context:void 0,c.textContent.trim(),c.getAttribute("data-mapwidth"),c.getAttribute("data-dx"),c.getAttribute("data-dy"),N,y):void 0;for(Object.freeze(this.maps),m=(null!=n&&null!=(g=n.getAttribute("data-characters"))?g.split(/\s+/):void 0)||[],l=0,u=m.length;l<u;l++)r=m[l],this.characters.load(r);for(p=(null!=n&&null!=(v=n.getAttribute("data-images"))?v.split(/\s+/):void 0)||[],a=0,h=p.length;a<h;a++)r=p[a],this.images.load(r);return this.run("init"),Object.seal(this)},e.prototype=Object.create(Jelli.prototype,{draw:{value:function(e){var t,i,n,r,s,l;if(this.clear)for(r=this.maps,t=0,i=r.length;t<i;t++)n=r[t],n.draw();return null!=(s=this.characters)&&s.doForEach(function(e){return e.draw()}),null!=(l=this.images)&&l.doForEach(function(e){return e.draw()}),this.clear=!1}},step:{value:function(){var e;return this.run("step"),null!=(e=this.characters)&&e.doForEach(function(e){return e.step()}),this.run("then")}}}),Object.freeze(e.prototype),this.Area=Object.freeze(e)}.call(this),function(){"use strict";var e,t,i,n=[].slice;t=function(e,t){if("object"==typeof e&&"object"==typeof t&&null!=e.next)return e[e.next]=t,Object.defineProperty(e[e.next],"kill",{value:this.kill.bind(e,e.next)}),e[e.next++]},i=function(e,t){var i,n;if("object"==typeof e&&("function"==typeof t||t instanceof Function))for(i in e)n=e[i],(null==this.Type||n instanceof this.Type)&&t(n)},e=function(e,n){var r,s,l;return e instanceof Area?(r=e,s=e.game):e instanceof Game&&(s=e),Object.defineProperties(this,{area:{value:r||null},Type:{value:"function"==typeof n||n instanceof Function?n:null},game:{value:s||null},parent:{value:"object"==typeof e?e:null}}),l={},Object.defineProperty(l,"next",{value:0,writable:!0}),Object.defineProperties(this,{"😶+":{value:t.bind(this,l)},doForNameless:{value:i.bind(this,l)}})},e.prototype=Object.create(Object.prototype,{doForEach:{value:function(e){var t,i;if("function"==typeof e||e instanceof Function){for(t in this)i=this[t],(null==this.Type||i instanceof this.Type)&&e(i,t);return this.doForNameless(e),this}}},kill:{value:function(e){var t,i;return(null!=(i=Object.getOwnPropertyDescriptor(this,e))?i.configurable:void 0)?(t=this[e],delete this[e]):t=null,t}},load:{value:function(){var e,t;return t=arguments[0],e=2<=arguments.length?n.call(arguments,1):[],null==this[t]?(Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:"function"==typeof this.Type||this.Type instanceof Function?function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(this.Type,[this,t].concat(n.call(e)),function(){}):null}),Object.defineProperty(this[t],"kill",{value:this.kill.bind(this,t)})):null}},loadNameless:{value:function(){var e;return e=1<=arguments.length?n.call(arguments,0):[],this["😶+"]("function"==typeof this.Type||this.Type instanceof Function?function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(this.Type,[this].concat(n.call(e)),function(){}):null)}}}),Object.freeze(e.prototype),this.Collection=Object.freeze(e)}.call(this),function(){"use strict";var e;e=function(e,t,i,n,r,s,l,a,o){return Jelli.call(this),e instanceof Game||(e=null),t instanceof Screen||(t=null),i=String(i),isNaN(s=Number(s))&&(s=0),isNaN(l=Number(l))&&(l=0),isNaN(a=Number(a))&&(a=s/2),isNaN(o=Number(o))&&(o=l/2),isNaN(n=Number(n))&&(n=a),isNaN(r=Number(r))&&(r=o),Object.defineProperties(this,{area:{get:function(){return e.area}},game:{value:e||null},height:{value:l},id:{value:i,enumerable:!0},origin_x:{value:a},origin_y:{value:o},screen:{value:t},width:{value:s},x:{enumerable:!0,get:function(){return n},set:function(e){if(!isNaN(e))return n=Number(e)}},y:{enumerable:!0,get:function(){return r},set:function(e){if(!isNaN(e))return r=Number(e)}}}),Object.defineProperties(this,{screen_x:{get:function(e){return function(){var t;return n-(null!=(t=e.area)?t.x:void 0)}}(this),set:function(e){return function(t){var i;if(!isNaN(t))return n=Number(t)+(null!=(i=e.area)?i.x:void 0)}}(this)},screen_y:{get:function(e){return function(){var t;return r-(null!=(t=e.area)?t.y:void 0)}}(this),set:function(e){return function(t){var i;if(!isNaN(t))return r=Number(t)+(null!=(i=e.area)?i.y:void 0)}}(this)}}),Object.defineProperty(this,"kill",{value:function(){},writable:!0}),Object.defineProperty(this,"edges",{value:Object.create(null,{top:{enumerable:!0,get:function(){return r-o},set:function(e){if(!isNaN(e))return r=Number(e)+o}},bottom:{enumerable:!0,get:function(){return r-o+l},set:function(e){if(!isNaN(e))return r=Number(e)-l+o}},left:{enumerable:!0,get:function(){return n-a},set:function(e){if(!isNaN(e))return n=Number(e)+a}},right:{enumerable:!0,get:function(){return n-a+s},set:function(e){if(!isNaN(e))return n=Number(e)-s+a}},screen_top:{enumerable:!0,get:function(e){return function(){return r-o-e.area.y}}(this),set:function(e){return function(t){if(!isNaN(t))return r=Number(t)+o+e.area.y}}(this)},screen_bottom:{enumerable:!0,get:function(e){return function(){return r-o+l-e.area.y}}(this),set:function(e){return function(t){if(!isNaN(t))return r=Number(t)-l+o+e.area.y}}(this)},screen_left:{enumerable:!0,get:function(e){return function(){return n-a-e.area.x}}(this),set:function(e){return function(t){if(!isNaN(t))return n=Number(t)+a+e.area.x}}(this)},screen_right:{enumerable:!0,get:function(e){return function(){return n-a+s-e.area.x}}(this),set:function(e){return function(t){if(!isNaN(t))return n=Number(t)-s+a+e.area.x}}(this)}})}),Object.freeze(this.edges)},e.prototype=Object.create(Jelli.prototype,{draw:{value:function(){}},setPosition:{value:function(e,t){return this.x=e,this.y=t}}}),Object.freeze(e.prototype),this.Unit=Object.freeze(e)}.call(this),function(){"use strict";var e,t=[].slice;e=function(){var e,i,n,r,s,l,a,o,u,h,c;switch(e=arguments[0],s=arguments[1],l=3<=arguments.length?t.call(arguments,2):[],l.length){case 0:r=s;break;case 1:"boolean"==typeof l[0]||l[0]instanceof Boolean?(r=s,a=l[0]):r=l[0];break;case 2:"boolean"==typeof l[1]||l[1]instanceof Boolean?(r=l[0],a=l[1]):(r=s,isNaN(h=Number(l[0]))&&(h=null),isNaN(c=Number(l[1]))&&(c=null));break;case 3:"boolean"==typeof l[2]||l[2]instanceof Boolean?(r=s,isNaN(h=Number(l[0]))&&(h=null),isNaN(c=Number(l[1]))&&(c=null),a=l[2]):(r=l[0],isNaN(h=Number(l[1]))&&(h=null),isNaN(c=Number(l[2]))&&(c=null),a=!1);break;default:r=l[0],isNaN(h=Number(l[1]))&&(h=null),isNaN(c=Number(l[2]))&&(c=null),a=l[3]}return a=!!a,e instanceof Collection||(e=null),n=null!=e?e.game:null,i=(null!=n?n.getDataElement("IMAGE",r):void 0)||null,i instanceof HTMLImageElement||i instanceof SVGImageElement||i instanceof HTMLCanvasElement||"undefined"!=typeof createImageBitmap&&null!==createImageBitmap&&i instanceof ImageBitmap||(i=null),(null==i||isNaN(u=Number(null!=i.naturalWidth?i.naturalWidth:source.width)))&&(u=0),(null==i||isNaN(o=Number(null!=i.naturalHeight?i.naturalHeight:source.height)))&&(o=0),Unit.call(this,n,n.screens[i.getAttribute("data-screen")],r,h,c,u,o,null!=i?i.getAttribute("data-origin-x"):void 0,null!=i?i.getAttribute("data-origin-y"):void 0),Object.defineProperties(this,{placed:{get:function(){return a},set:function(e){return a=!!e}},source:{value:i}}),Object.seal(this)},e.prototype=Object.create(Unit.prototype,{draw:{value:function(){if(this.placed&&this.screen instanceof Screen&&(this.source instanceof HTMLImageElement&&this.source.complete||this.source instanceof SVGImageElement||this.source instanceof HTMLCanvasElement||"undefined"!=typeof createImageBitmap&&null!==createImageBitmap&&(this.source instanceof ImageBitmap||this.source instanceof ImageBitmap)))return this.screen.context.drawImage(this.source,Math.floor(this.edges.screen_left),Math.floor(this.edges.screen_top))}},togglePlacement:{value:function(e){return null!=e?this.placed=!!e:this.placed=!this.placed}}}),Object.freeze(e.prototype),this.PlacementImage=Object.freeze(e)}.call(this),function(){"use strict";var e,t=[].slice;e=function(){var i,n,r,s,l,a,o,u,h,c,f,d,b,g,m,v,p,N,y,O,w,E,T,_;switch(i=arguments[0],f=arguments[1],d=3<=arguments.length?t.call(arguments,2):[],d.length){case 0:u=f;break;case 1:u=d[0];break;case 2:u=f,isNaN(T=Number(d[0]))&&(T=null),isNaN(_=Number(d[1]))&&(_=null);break;case 3:u=f,isNaN(T=Number(d[0]))&&(T=null),isNaN(_=Number(d[1]))&&(_=null),n=d[2];break;default:u=d[0],isNaN(T=Number(d[1]))&&(T=null),isNaN(_=Number(d[2]))&&(_=null),n=d[3]}for(null==n&&(n=0),i instanceof Collection||(i=null),a=null!=i?i.game:null,s=(null!=a?a.getDataElement("CHARACTER",u):void 0)||null,w={},O=(null!=a?a.getDataElement("SPRITELIST",null!=s?s.getAttribute("data-sprites"):void 0):void 0)||null,b=(null!=O?O.getElementsByClassName("SPRITE"):void 0)||[],h=o=0,c=b.length;o<c;h=++o)y=b[h],w[h]=(null!=a&&null!=(g=a.sheets[O.dataset.sheet])?g.getSprite(y.dataset.index,y.dataset.length):void 0)||null,y.hasAttribute("title")&&isNaN(y.getAttribute("title"))&&(w[y.getAttribute("title")]=w[h]);return Object.freeze(w),Unit.call(this,a,a.screens[null!=s?s.getAttribute("data-screen"):void 0],u,T,_,(null!=O?O.dataset.boxWidth:void 0)||(null!=(m=w[0])?m.width:void 0),(null!=O?O.dataset.boxHeight:void 0)||(null!=(v=w[0])?v.height:void 0),null!=O?O.dataset.originX:void 0,null!=O?O.dataset.originY:void 0),Object.defineProperties(this,{box_x:{value:isNaN(null!=O?O.dataset.boxX:void 0)?0:Number(null!=O?O.dataset.boxX:void 0)},box_y:{value:isNaN(null!=O?O.dataset.boxY:void 0)?0:Number(null!=O?O.dataset.boxY:void 0)},collides:{value:function(){switch(null!=s?s.dataset.collides:void 0){case void 0:return e.collisions.DOES_NOT_COLLIDE;case"map":return e.collisions.MAP;case"character":return e.collisions.CHARACTER;default:return e.collisions.ALL}}()},functions:{value:null!=s?s.functions:void 0},max_velocity:{value:isNaN(null!=s?s.dataset.speedcap:void 0)?e.NO_MAX_VELOCITY:Number(null!=s?s.dataset.speedcap:void 0)},sprite_height:{value:(null!=(p=w[0])?p.height:void 0)||0},sprite_width:{value:null!=(N=w[0])?N.width:void 0},sprites:{value:w},step:{value:this.run.bind(this,"step")}}),this.sprites[n]||(n=0),r=null,l=0,E=0,Object.defineProperties(this,{direction:{get:function(){return r},set:function(e){return r=isNaN(e)?null:Number(e)},enumerable:!0},frame:{get:function(){return l},set:function(e){if(!(isNaN(e=Number(e))||e<0||e>=this.sprites[this.sprite].frames))return l=e},enumerable:!0},sprite:{get:function(){return n},set:function(e){if(null!=this.sprites[e])return n=e},enumerable:!0},velocity:{get:function(){return E},set:function(e){if(!isNaN(e))return E=Number(e)},enumerable:!0}}),this.run("init"),Object.seal(this)},e.prototype=Object.create(Unit.prototype,{draw:{value:function(){var e,t;return null!=(e=this.sprites[this.sprite])?e.draw(null!=(t=this.screen)?t.context:void 0,this.edges.screen_left-this.box_x,this.edges.screen_top-this.box_y,this.frame):void 0}},getCollisionEdge:{value:function(t,i,n){if(!(t!==Tileset.Map.BOTTOM_EDGE&&t!==Tileset.Map.LEFT_EDGE&&t!==Tileset.Map.RIGHT_EDGE&&t!==Tileset.Map.TOP_EDGE||isNaN(i=Number(i))||isNaN(n=Number(n)))){if(!(this.collides&e.collisions.CHARACTER&&Math.round(this.edges.left)<i&&i<Math.round(this.edges.right)&&Math.round(this.edges.top)<n&&n<Math.round(this.edges.bottom)))switch(t){case Tileset.Map.LEFT_EDGE:case Tileset.Map.RIGHT_EDGE:return i;case Tileset.Map.TOP_EDGE:case Tileset.Map.BOTTOM_EDGE:return n}switch(t){case Tileset.Map.LEFT_EDGE:return Math.round(this.edges.left);case Tileset.Map.RIGHT_EDGE:return Math.round(this.edges.right);case Tileset.Map.TOP_EDGE:return Math.round(this.edges.top);case Tileset.Map.BOTTOM_EDGE:return Math.round(this.edges.bottom)}}}},target:{value:function(e,t){return this.targetBy(e-this.x,t-this.y)}},targetBy:{value:function(t,i){var n,r,s,l,a,o,u,h,c,f,d,b,g,m,v,p,N,y,O,w;if(n=Math.sqrt(t*t+i*i),this.area instanceof Area&&this.area.characters instanceof Collection&&this.area.maps instanceof Object){if(s=this.x,l=this.y,this.max_velocity!==e.NO_MAX_VELOCITY&&n>this.max_velocity&&(t=t/n*this.max_velocity,i=i/n*this.max_velocity),t>0){if(O=this.edges.right+t,this.collides&e.collisions.MAP)for(v=this.area.maps,r=0,h=v.length;r<h;r++)for(g=v[r],o=Math.floor(this.height/(g.tile_height/2))+2,a=-1;++a<=o;)w=g.getCollisionEdge(Tileset.Map.LEFT_EDGE,O,this.edges.top+a*this.height/o),O>w&&(O=w);this.collides&e.collisions.CHARACTER&&this.area.characters.doForEach(function(t){return function(i){var n;if(t!==i&&i.collides&e.collisions.CHARACTER){for(o=Math.floor(t.height/i.height)+2,a=-1,n=[];++a<=o;)w=i.getCollisionEdge(Tileset.Map.LEFT_EDGE,O,t.edges.top+a*t.height/o),O>w?n.push(O=w):n.push(void 0);return n}}}(this)),O>this.edges.right&&(this.edges.right=O)}if(t<0){if(O=this.edges.left+t,this.collides&e.collisions.MAP)for(p=this.area.maps,u=0,c=p.length;u<c;u++)for(g=p[u],o=Math.floor(this.height/(g.tile_height/2))+2,a=-1;++a<=o;)w=g.getCollisionEdge(Tileset.Map.RIGHT_EDGE,O,this.edges.top+a*this.height/o),O<w&&(O=w);this.collides&e.collisions.CHARACTER&&this.area.characters.doForEach(function(t){return function(i){var n;if(t!==i&&i.collides&e.collisions.CHARACTER){for(o=Math.floor(t.height/i.height)+2,a=-1,n=[];++a<=o;)w=i.getCollisionEdge(Tileset.Map.RIGHT_EDGE,O,t.edges.top+a*t.height/o),O<w?n.push(O=w):n.push(void 0);return n}}}(this)),O<this.edges.left&&(this.edges.left=O)}if(i>0){if(O=this.edges.bottom+i,this.collides&e.collisions.MAP)for(N=this.area.maps,b=0,f=N.length;b<f;b++)for(g=N[b],o=Math.floor(this.width/(g.tile_width/2))+2,a=-1;++a<=o;)w=g.getCollisionEdge(Tileset.Map.TOP_EDGE,this.edges.left+a*this.width/o,O),O>w&&(O=w);this.collides&e.collisions.CHARACTER&&this.area.characters.doForEach(function(t){return function(i){var n;if(t!==i&&i.collides&e.collisions.CHARACTER){for(o=Math.floor(t.width/i.width)+2,a=-1,n=[];++a<=o;)w=i.getCollisionEdge(Tileset.Map.TOP_EDGE,t.edges.left+a*t.width/o,O),O>w?n.push(O=w):n.push(void 0);return n}}}(this)),O>this.edges.bottom&&(this.edges.bottom=O)}if(i<0){if(O=this.edges.top+i,this.collides&e.collisions.MAP)for(y=this.area.maps,m=0,d=y.length;m<d;m++)for(g=y[m],o=Math.floor(this.width/(g.tile_width/2))+2,a=-1;++a<=o;)w=g.getCollisionEdge(Tileset.Map.BOTTOM_EDGE,this.edges.left+a*this.width/o,O),O<w&&(O=w);this.collides&e.collisions.CHARACTER&&this.area.characters.doForEach(function(t){return function(i){var n;if(t!==i&&i.collides&e.collisions.CHARACTER){for(o=Math.floor(t.width/i.width)+2,a=-1,n=[];++a<=o;)w=i.getCollisionEdge(Tileset.Map.BOTTOM_EDGE,t.edges.left+a*t.width/o,O),O<w?n.push(O=w):n.push(void 0);return n}}}(this)),O<this.edges.top&&(this.edges.top=O)}return t=this.x-s,i=this.y-l,this.direction=Math.atan2(t,-i),this.velocity=Math.sqrt(t*t+i*i)}}}}),Object.freeze(e.prototype),e.collisions={DOES_NOT_COLLIDE:0,MAP:1,CHARACTER:2,ALL:3},Object.freeze(e.collisions),Object.defineProperty(e,"NO_MAX_VELOCITY",{value:"undefined"!=typeof Symbol&&null!==Symbol?Symbol("Infinity"):Object.freeze(Object.create(null))}),this.Character=Object.freeze(e)}.call(this),function(){"use strict";var e;e=function(e,t,i,n,r,s){var l,a,o,u,h;return null==s&&(s=!1),e instanceof Collection||(e=null),o=null!=e?e.game:null,l=null!=e?e.area:null,null!=o?(a=null!=(h=o.screens[i])?h.context:void 0,u=o.letters[n],s&&(r=o.window.atob(r))):a=u=null,Object.defineProperty(this,"block",{value:null!=u?u.createBlock.apply(u,[a,0,0].concat(r.split(u.source.getAttribute("data-linefeed")))):void 0}),Object.defineProperties(this,{advance:{value:this.block.advance.bind(this.block)},clear:{value:this.block.clear.bind(this.block)},fill:{value:this.block.fill.bind(this.block)},item:{value:this.block.item.bind(this.block)},line:{value:this.block.line.bind(this.block)}}),Object.defineProperties(this,{delIndex:{get:function(){return this.block.delIndex},set:function(e){return this.block.delIndex=e}},drawIndex:{get:function(){return this.block.drawIndex},set:function(e){return this.block.drawIndex=e}},index:{get:function(){return this.block.index},set:function(e){return this.block.index=e}},length:{value:this.block.length},x:{get:function(){return this.block.x},set:function(e){return this.block.x=e}},y:{get:function(){return this.block.y},set:function(e){return this.block.y=e}}}),Object.defineProperties(this,{color:{value:null,writable:!0},context:{value:a,enumerable:!0},kill:{value:null,writable:!0}}),Object.seal(this)},e.prototype=Object.create(Object.prototype,{draw:{value:function(){var e,t;if((null!=(e=this.block)?e.letters:void 0)instanceof Letters)return this.color?this.block.letters.color=null!=(t=this.block.letters.source)?t.getAttribute("data-palette-"+this.color):void 0:this.block.letters.clearColor(),this.block.draw()}}}),Object.freeze(e.prototype),this.Text=Object.freeze(e)}.call(this),function(){"use strict";var e;e=function(e,t){var i,n,r,s,l,a,o;for(e instanceof Game||(e=null),t instanceof Element||(t=(null!=e?e.getDocElement(t):void 0)||null),isNaN(this.height=Number(null!=t?t.getAttribute("data-height"):void 0))&&(this.height=0),this.screens={},this.target=t,isNaN(this.width=Number(null!=t?t.getAttribute("data-width"):void 0))&&(this.width=0),null!=t&&(t.textContent=""),t.style.visibility="hidden",i=null,a=(null!=t&&null!=(l=t.getAttribute("data-screens"))?l.split(/\s+/):void 0)||[],n=0,r=a.length;n<r;n++)s=a[n],o=null!=e?e.getDataElement("SCREEN",s):void 0,o&&(this.screens[s]=new Screen(t.appendChild(o),"2d"),null==i&&(i=this.screens[s]));return Object.freeze(this.screens),this.control=new Control(null!=i?i.canvas:t,0,0,this.width,this.height),Object.freeze(this)},e.prototype=Object.create(Object.prototype,{layout:{value:function(){var e,t,i,n,r,s,l,a;if(this.target instanceof Element){"static"===this.target.ownerDocument.defaultView.getComputedStyle(this.target).position&&(this.target.style.position="relative"),this.target.style.minWidth=this.width+"px",this.target.style.minHeight=this.height+"px",i=this.target.clientWidth,t=this.target.clientHeight,r=this.screens;for(n in r)a=r[n],e=a.canvas,e.width!==this.width&&(e.width=this.width),e.height!==this.height&&(e.height=this.height),i/t<this.width/this.height?(l=i<this.width?i:this.width*Math.floor(i/this.width),s=Math.floor(this.height*l/this.width)):(s=t<this.height?t:this.height*Math.floor(t/this.height),l=Math.floor(this.width*s/this.height)),e.style.display="block",e.style.position="absolute",e.style.margin="0",e.style.border="none",e.style.padding="0",e.style.width=l+"px",e.style.height=s+"px",e.style.top="calc(50% - "+s/2+"px)",e.style.left="calc(50% - "+l/2+"px)";this.target.style.visibility=""}}}}),Object.freeze(e.prototype),this.View=Object.freeze(e)}.call(this);
